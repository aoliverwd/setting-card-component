export class SettingCard extends HTMLElement{constructor(){super(),this.attachShadow({mode:"open"});const e=this.getTemplate(),t=this.innerHTML;this.innerHTML="",this.shadowRoot.appendChild(e.content.cloneNode(!0)),this.shadowRoot.querySelector(".setting_card .content").innerHTML=t;try{this.shadowRoot.querySelector("button.update_settings").onclick=e=>{this.updateSettings(e.target)};const e=document.createElement("p");e.id="return_text",this.shadowRoot.querySelector(".setting_card").appendChild(e)}catch(e){console.error("Save settings button does not exist")}setTimeout((()=>{this.shadowRoot.querySelector(".setting_card").classList.add("loaded")}),500)}getTemplate(){const e=this.getAttribute("card-title"),t=document.createElement("template"),s=this.getAttribute("style_path")||"./";return t.innerHTML=`\n        <link rel="stylesheet" href="${s}card-styles.css">\n\n        <div class="setting_card" data-style_path="${s}">\n            <h1 class="card_title">${e}</h1>\n            <div class="content"></div>\n        </div>`,t}updateSettings(e){const t=e.textContent,s=e.closest(".content");e.textContent="Processing",e.classList.add("processing"),s.classList.add("processing");const n=btoa(JSON.stringify(this.getInputFields()));let o,r=!1;this.sendPostRequest(n).then((e=>{e.success?(console.debug(e.messages),o=e.messages):(console.error(e.messages),o=e.messages,r=!0)})).catch((e=>{console.error(e)})),setTimeout((()=>{s.classList.remove("processing"),e.classList.remove("processing"),e.textContent=t,this.showReturnField(o,r)}),1e3)}showReturnField(e,t){const s=this.shadowRoot.querySelector("#return_text");s.innerHTML=e.join(", "),s.setAttribute("class",""),t&&s.classList.add("error"),s.classList.add("show"),setTimeout((()=>{s.classList.remove("show")}),2500)}getInputFields(){const e={};return this.shadowRoot.querySelectorAll("form-input").forEach((t=>{const s=t.shadowRoot.querySelector("input");try{switch(e[s.name]={value:s.value,name:s.name,type:s.type,required:s.required||!1},s.type){case"checkbox":case"radio":e[s.name].checked=!!s.checked,e[s.name].value=e[s.name].checked}}catch(e){console.error("Input not found or is missing attributes")}})),e}async sendPostRequest(e){const t=this.getAttribute("post-to-endpoint")||!1;return(await fetch(t,{headers:{"Content-Type":"application/json","X-WP-Nonce":this.getAttribute("wp_nonce")||""},redirect:"follow",cache:"no-cache",method:"POST",mode:"cors",body:JSON.stringify({base:e})})).json()}}window.customElements.define("setting-card",SettingCard);export class FormInput extends HTMLElement{constructor(){super(),this.attachShadow({mode:"open"});const e=this.getTemplate();this.innerHTML="",this.shadowRoot.appendChild(e.content.cloneNode(!0))}getTemplate(){const e=document.createElement("template"),t=this.getInput(),s=this.closest(".setting_card").getAttribute("data-style_path")||"./";return e.innerHTML=`\n        <link rel="stylesheet" href="${s}input-styles.css">\n        ${t}`,e}getInput(){const e=this.gerDefaults();return"toggle"===e.type?`\n            <p>\n                <label for="${e.name}">${e.title}:</label>\n                <label class="toggle">\n                    <input\n                        type="checkbox"\n                        `+(e.checked?'checked="checked"':"")+`\n                        name="${e.name}"\n                        value="${e.value}"\n                        aria-label="${e.title}"\n                    >\n                    <span class="slider"></span>\n                </label>\n            </p>`:`\n            <p>\n                <label for="${e.name}">${e.title}:</label>\n                <input\n                    type="${e.type}"\n                    name="${e.name}"\n                    id="${e.name}"\n                    value="${e.value}"\n                    `+(e.required?'required="required"':"")+`\n                    placeholder="${e.placeholder}"\n                    aria-label="${e.title}"\n                >\n                <small>${e.helper_text}</small>\n            </p>`}gerDefaults(){return{type:this.getAttribute("type")||"text",title:this.getAttribute("title")||"",name:this.getAttribute("name")||"",required:this.getAttribute("required")||!1,value:this.getAttribute("value")||"",placeholder:this.getAttribute("placeholder")||"",checked:this.getAttribute("checked")||!1,helper_text:this.textContent||""}}}window.customElements.define("form-input",FormInput);
