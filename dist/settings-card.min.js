export class SettingCard extends HTMLElement{constructor(){super(),this.attachShadow({mode:"open"});const t=this.getTemplate(),e=this.innerHTML;this.innerHTML="",this.shadowRoot.appendChild(t.content.cloneNode(!0)),this.shadowRoot.querySelector(".setting_card .content").innerHTML=e;try{this.shadowRoot.querySelector("button.update_settings").onclick=t=>{this.updateSettings(t.target)};const t=document.createElement("p");t.id="return_text",this.shadowRoot.querySelector(".setting_card").appendChild(t)}catch(t){console.error("Save settings button does not exist")}this.shadowRoot.querySelectorAll("button[data-action]").forEach((t=>{const e=this;t.addEventListener("click",(()=>{const n=t.getAttribute("data-action");n.length>0&&"function"==typeof window[n]&&window[n].call(this,t,e)}))})),setTimeout((()=>{this.shadowRoot.querySelector(".setting_card").classList.add("loaded")}),500)}getTemplate(){const t=this.getAttribute("card-title"),e=document.createElement("template"),n=this.getAttribute("style_path")||"./",r=this.getAttribute("external_style")||"./";let o="";return r.length>0&&(o=`<link rel="stylesheet" href="${r}">`),e.innerHTML=`\n        <style>.setting_card{box-shadow:0 0 4px rgba(0,0,0,0.1);height:calc(100% - 4rem);background-color:white;position:relative;border-radius:4px;line-height:1.3;font-size:1rem;padding:2rem}.setting_card .content.processing{pointer-events:none}.setting_card .content.processing>*:not(button){opacity:0.4}.setting_card a{color:var(--accent_button, #fd3599)}@keyframes spinner{from{transform:rotate(0deg)}to{transform:rotate(360deg)}}.setting_card .group{flex-flow:row wrap;display:flex;gap:1rem}.setting_card .split_section{grid-template-columns:repeat(2, 1fr);column-gap:1rem;display:grid}.setting_card form-input[type="hidden"]{display:none}.setting_card .button,.setting_card button{all:unset;background-color:var(--accent_button, #fd3599);color:var(--accent_button_color, white);padding:0.8rem 1.5rem;position:relative;border-radius:4px;font-size:inherit;cursor:pointer;line-height:1;color:white}.setting_card .button:hover,.setting_card button:hover{background-color:var(--accent_button_hover, #fc0380)}.setting_card .button:focus,.setting_card button:focus{background-color:var(--accent_button_active, #ca0266)}.setting_card .button.processing,.setting_card button.processing{padding-right:50px}.setting_card .button.processing::after,.setting_card button.processing::after{animation-timing-function:ease-in-out;animation-iteration-count:infinite;animation-name:spinner;animation-duration:1s;background-color:var(--accent_button_color, white);transform:translateX(-50%);top:calc(50% - 7px);position:absolute;border-radius:4px;display:block;height:15px;content:"";width:15px;right:15px;z-index:1}.setting_card .button{text-decoration:none}.setting_card h1,.setting_card h2,.setting_card h3{font-weight:normal;font-size:1.6rem;margin-block:0;line-height:1}.setting_card h1:is(h2),.setting_card h2:is(h2),.setting_card h3:is(h2){margin-top:2.5rem;font-size:1.4rem}.setting_card h1:is(h3),.setting_card h2:is(h3),.setting_card h3:is(h3){font-size:1.2rem}.setting_card h1::after,.setting_card h2::after,.setting_card h3::after{background-color:rgba(0,0,0,0.1);margin-block:1.2rem;display:block;height:1px;content:"";width:100%}.setting_card hr{all:unset;background-color:rgba(0,0,0,0.1);margin-block:1.2rem;display:block;height:1px;content:"";width:100%}.setting_card.loaded #return_text{transition-property:opacity, transform;transition-timing-function:ease;transition-duration:300ms}.setting_card #return_text{border:solid 0.0625rem #8dd75b;background-color:#c6ebad;color:#386719;width:calc(100% - 6rem);border-radius:0.25rem;pointer-events:none;position:absolute;padding:1rem;opacity:0;margin:0;bottom:0}.setting_card #return_text.error{background-color:var(--input_error_background, #fff5fa);border-color:var(--input_error, #fd3599);color:var(--input_error, #fd3599)}.setting_card #return_text.show{transform:translateY(-1.5rem);pointer-events:all;opacity:1}.setting_card .notice{background-color:#ccdeff;border-radius:0.375rem;margin-block:1.25rem;padding:1.25rem}.setting_card .notice h2{font-size:1.2rem}.setting_card .notice.info{background-color:#f1ccff}.setting_card .notice.warning{background-color:#ffce99}.setting_card .notice.error{background-color:#ffadad}.setting_card .notice::last-child{margin-bottom:0}.setting_card .notice>*:first-child{margin-top:0}.setting_card .notice>*:last-child{margin-bottom:0}\n</style>\n        ${o}\n\n        <div class="setting_card" data-style_path="${n}">\n            <h1 class="card_title">${t}</h1>\n            <div class="content"></div>\n        </div>`,e}formProcessing(t){const e=t.closest(".content"),n=t.textContent;return t.textContent="Processing",t.classList.add("processing"),e.classList.add("processing"),n}formFinishedProcessing(t,e){t.closest(".content").classList.remove("processing"),t.classList.remove("processing"),t.textContent=e}updateSettings(t){const e=this.formProcessing(t);let n=!0;const r=this.getInputFields();if(!r.valid)return this.formFinishedProcessing(t,e),void this.showReturnField(["Some fields did not validate"],n);const o=btoa(JSON.stringify(r));let i=["No message to display"];this.sendPostRequest(o).then((r=>{r.success?(console.debug(r.messages),i=r.messages,n=!1):(console.error(r.messages),i=r.messages,n=!0),this.formFinishedProcessing(t,e),this.showReturnField(i,n)})).catch((t=>{console.error(t)}))}showReturnField(t,e){const n=this.shadowRoot.querySelector("#return_text");n.innerHTML=t.join(", "),n.setAttribute("class",""),e&&n.classList.add("error"),n.classList.add("show"),setTimeout((()=>{n.classList.remove("show")}),3e3)}validateInput(t){return t.value.length>0}getInputFields(){const t={valid:!0};return this.shadowRoot.querySelectorAll("form-input").forEach((e=>{const n=e.shadowRoot.querySelector("input, textarea");if(n)try{switch(t[n.name]={value:n.value,name:n.name,type:n.type,required:n.required||!1},n.type){case"checkbox":case"radio":t[n.name].checked=!!n.checked,t[n.name].value=t[n.name].checked}if("hidden"!==n.type){const e=!n.required||this.validateInput(n);t[n.name].valid=e,n.parentNode.classList.remove("invalid"),e||(n.parentNode.classList.add("invalid"),t.valid=!1)}}catch(t){console.error("Input not found or is missing attributes",n)}})),console.debug(t),t}async sendPostRequest(t,e,n){const r="string"==typeof e&&e.length>0?e:this.getAttribute("post-to-endpoint")||!1;let o="POST";if("string"==typeof n&&n.length>0)switch(n.toLowerCase()){case"get":case"put":case"delete":o=n.toUpperCase()}const i={headers:{"Content-Type":"application/json","X-WP-Nonce":this.getAttribute("wp_nonce")||""},redirect:"follow",cache:"no-cache",method:o,mode:"cors",body:JSON.stringify({base:t})};"GET"===o&&delete i.body;return(await fetch(r,i)).json()}}window.customElements.define("setting-card",SettingCard);export class FormInput extends HTMLElement{constructor(){super(),this.attachShadow({mode:"open"});const t=this.getTemplate();this.innerHTML="",this.shadowRoot.appendChild(t.content.cloneNode(!0))}getTemplate(){const t=document.createElement("template"),e=this.getInput();this.closest(".setting_card").getAttribute("data-style_path");return t.innerHTML=`\n        <style>p{font-size:1rem}p input,p textarea{background-color:#efeff0;border:solid 1px #d5d5d7;width:calc(100% - 1.9rem);font-family:inherit;margin-block:0.5em;border-radius:4px;font-size:inherit;display:block;padding:0.8em}p input:focus,p textarea:focus{outline:solid 1px var(--accent_button, #fd3599);border-color:var(--accent_button, #fd3599)}p textarea{min-height:100px;max-height:300px;resize:vertical}p .helper{margin-block:5px 0;display:block;opacity:0.6}p .toggle{margin-block:0.5em;border-radius:4px;position:relative;font-size:0.9rem;overflow:hidden;cursor:pointer;display:block;height:34px;width:105px}p .toggle input{opacity:0;height:0;width:0}p .toggle input:checked+.slider:before{transform:translate(calc(100% + 44px), -50%);background-color:var(--accent_button_color, white)}p .toggle input:checked+.slider:after{color:var(--accent_button_color, white);content:"Enabled";right:auto;left:10px}p .toggle input:checked+.slider{background-color:var(--accent_button, #fd3599)}p .toggle .slider{background-color:var(--input_background, #efeff0);transition:background ease 200ms;position:absolute;bottom:0;right:0;left:0;top:0}p .toggle .slider::before{transition-property:transform, border-radius;transition-timing-function:ease;transition-duration:200ms;background-color:var(--body_color, #333);transform:translateY(-50%);border-radius:4px;position:absolute;opacity:0.9;height:22px;content:"";width:22px;left:8px;top:50%}p .toggle .slider::after{transform:translateY(-50%);color:var(--body_color, #333);position:absolute;content:"Disabled";right:10px;top:50%}p.invalid{color:var(--input_error, #fd3599)}p.invalid input,p.invalid textarea{background-color:var(--input_error_background, #fff5fa);border-color:var(--input_error, #fd3599)}p.invalid input:focus,p.invalid textarea:focus{outline:solid 1px var(--input_error, #fd3599);border-color:var(--input_error, #fd3599)}p.invalid .helper{opacity:1}\n</style>\n        ${e}`,t}getInput(){const t=this.gerDefaults();switch(t.type){case"toggle":return`\n            <p>\n                <label for="${t.name}">${t.title}:</label>\n                <small class="helper">${t.helper_text}</small>\n                <label class="toggle">\n                    <input\n                        type="checkbox"\n                        `+(t.checked?'checked="checked"':"")+`\n                        name="${t.name}"\n                        value="${t.value}"\n                        aria-label="${t.title}"\n                    >\n                    <span class="slider"></span>\n                </label>\n            </p>`;case"hidden":return`\n            <input\n                type="hidden"\n                name="${t.name}"\n                value="${t.value}"\n            >`;case"textarea":return`\n            <p>\n                <label for="${t.name}">${t.title}:</label>\n                <small class="helper">${t.helper_text}</small>\n                <textarea\n                    type="${t.type}"\n                    name="${t.name}"\n                    id="${t.name}"\n                    `+(t.required?'required="required" ':"")+"\n                    "+(t.disabled?"disabled ":"")+`\n                    placeholder="${t.placeholder}"\n                    aria-label="${t.title}"\n                    rows="${t.rows}"\n                >${t.value}</textarea>\n            </p>`;default:return`\n            <p>\n                <label for="${t.name}">${t.title}:</label>\n                <small class="helper">${t.helper_text}</small>\n                <input\n                    type="${t.type}"\n                    name="${t.name}"\n                    id="${t.name}"\n                    value="${t.value}"\n                    `+(t.required?'required="required" ':"")+"\n                    "+(t.disabled?"disabled":"")+`\n                    placeholder="${t.placeholder}"\n                    aria-label="${t.title}"\n                >\n            </p>`}return""}gerDefaults(){return{type:this.getAttribute("type")||"text",title:this.getAttribute("title")||"",name:this.getAttribute("name")||"",required:this.getAttribute("required")||!1,disabled:this.getAttribute("disabled")||!1,value:this.getAttribute("value")||"",placeholder:this.getAttribute("placeholder")||"",checked:this.getAttribute("checked")||!1,helper_text:this.textContent||"",rows:this.getAttribute("rows")||5}}}window.customElements.define("form-input",FormInput);
