import{getInputFields}from"./settings-card.js";export class AddRows extends HTMLElement{constructor(){super(),this.attachShadow({mode:"open"});const t=this.getTemplate();this.innerHTML="",this.shadowRoot.appendChild(t.content.cloneNode(!0)),this.loadData(),this.shadowRoot.addEventListener("click",(t=>{if("button"===t.target.nodeName.toLowerCase()){const e=t.target.getAttribute("data-action");e&&"function"==typeof this[e]?this[e].call(this,t.target):e&&"function"==typeof window[e]&&window[e].call(this,t.target)}}))}getTemplate(){const t=document.createElement("template"),e=(this.closest(".setting_card").getAttribute("data-style_path"),this.querySelector("template")),o=e?e.innerHTML:"",r=this.getAttribute("addrow-text")||"Add Row",n=this.getAttribute("save-text")||"Save";return t.innerHTML=`\n        <style>.setting_card{box-shadow:0 0 4px rgba(0,0,0,0.1);height:calc(100% - 4rem);background-color:white;position:relative;border-radius:4px;line-height:1.3;font-size:1rem;padding:2rem}.content.processing{pointer-events:none}.content.processing>*:not(button){opacity:0.4}a{color:var(--accent_button, #fd3599)}@keyframes spinner{from{transform:rotate(0deg)}to{transform:rotate(360deg)}}.group{flex-flow:row wrap;display:flex;gap:1rem}.split_section{grid-template-columns:repeat(2, 1fr);column-gap:1rem;display:grid}form-input[type="hidden"]{display:none}.button,button{all:unset;background-color:var(--accent_button, #fd3599);color:var(--accent_button_color, white);padding:0.8rem 1.5rem;position:relative;border-radius:4px;font-size:inherit;cursor:pointer;line-height:1;color:white}.button:hover,button:hover{background-color:var(--accent_button_hover, #fc0380)}.button:focus,button:focus{background-color:var(--accent_button_active, #ca0266)}.button.processing,button.processing{padding-right:50px}.button.processing::after,button.processing::after{animation-timing-function:ease-in-out;animation-iteration-count:infinite;animation-name:spinner;animation-duration:1s;background-color:var(--accent_button_color, white);transform:translateX(-50%);top:calc(50% - 7px);position:absolute;border-radius:4px;display:block;height:15px;content:"";width:15px;right:15px;z-index:1}.button.warning,button.warning{background-color:#ca0202}.button.warning:hover,button.warning:hover{background-color:#970202}.button{text-decoration:none}h1,h2,h3{font-weight:normal;font-size:1.6rem;margin-block:0;line-height:1}h1:is(h2),h2:is(h2),h3:is(h2){margin-top:2.5rem;font-size:1.4rem}h1:is(h3),h2:is(h3),h3:is(h3){font-size:1.2rem}h1::after,h2::after,h3::after{background-color:rgba(0,0,0,0.1);margin-block:1.2rem;display:block;height:1px;content:"";width:100%}hr{all:unset;background-color:rgba(0,0,0,0.1);margin-block:1.2rem;display:block;height:1px;content:"";width:100%}.loaded #return_text{transition-property:opacity, transform;transition-timing-function:ease;transition-duration:300ms}#return_text{border:solid 0.0625rem #8dd75b;background-color:#c6ebad;color:#386719;width:calc(100% - 6rem);border-radius:0.25rem;pointer-events:none;position:absolute;padding:1rem;opacity:0;margin:0;bottom:0}#return_text.error{background-color:var(--input_error_background, #fff5fa);border-color:var(--input_error, #fd3599);color:var(--input_error, #fd3599)}#return_text.show{transform:translateY(-1.5rem);pointer-events:all;opacity:1}.notice{background-color:#ccdeff;border-radius:0.375rem;margin-block:1.25rem;padding:1.25rem}.notice h2{font-size:1.2rem}.notice.info{background-color:#f1ccff}.notice.warning{background-color:#ffce99}.notice.error{background-color:#ffadad}.notice::last-child{margin-bottom:0}.notice>*:first-child{margin-top:0}.notice>*:last-child{margin-bottom:0}\n</style>\n        <style>#rows{flex-flow:wrap;display:flex;gap:20px}#rows>*{background-color:#efeff0;border-radius:6px;flex-basis:100%}#rows>*:last-child{margin-block-end:20px}#rows>* button[data-action="removeRow"]{margin-inline-start:auto;display:table}#rows details{padding:10px}#rows details[open] svg{transform:rotate(180deg)}#rows details[open] summary{background-color:white}#rows details summary{align-items:center;position:relative;border-radius:6px;font-size:1.2rem;list-style:none;cursor:pointer;display:flex;padding:10px;gap:10px}#rows details summary:hover{background-color:white}#rows details summary::-webkit-details-marker,#rows details summary::marker{display:none}#rows details summary svg{margin-inline-start:auto;background-color:#333;border-radius:4px;max-width:20px;padding:10px}#rows details summary svg path{fill:white}#rows details summary>span{align-items:center;display:flex;flex-grow:3;gap:20px}#rows details summary>span button{line-height:1.2;font-size:1rem;padding:10px}#rows details>section{padding:0 10px 10px 10px}#buttons{border-bottom:solid 1px rgba(0,0,0,0.1);padding-block-end:20px;display:flex;gap:1rem}\n</style>\n        <div class="content">\n            <div id="rows"></div>\n            <div id="buttons">\n                <button type="button" data-action="addRow">${r}</button>\n                <button type="button" data-action="saveData">${n}</button>\n            </div>\n        </div>\n        <textarea id="rows_data" disabled style="display: none;"></textarea>\n        <template id="row_template">${o}</template>`,t}getCurrentTemplate(){const t=this.shadowRoot.querySelector("#row_template");return t?t.innerHTML:""}addRow(t,e,o=!0){const r=this.shadowRoot.querySelector("#rows"),n=document.createElement("details"),a=this.closest("[data-style_path]"),i=this.getAttribute("removerow-text")||"Remove Row",s=this.getAttribute("row-title")||"Row",d=r.querySelectorAll("details").length+1;n.setAttribute("class","row"),o&&(n.open=!0),a&&n.setAttribute("data-style_path",a.getAttribute("data-style_path")),n.innerHTML=`\n        <summary>\n            <span>\n                ${s}: ${d}\n                <button data-action="removeRow" data-blur="resetButton" class="warning">${i}</button>\n            </span>\n            <svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg"><path d="M511.9 652.4l379.9-365.6c13.8-13.7 36.2-13.7 50.1 0 13.8 13.7 13.8 35.9 0 49.6L537.1 737.3c-13.9 13.7-36.3 13.7-50.1 0L82.1 336.4c-13.9-13.7-13.8-35.9 0-49.6s36.2-13.7 50.1 0z"/></svg>\n        </summary>\n        <section>${this.getCurrentTemplate()}</section>`,"object"==typeof e&&Object.keys(e).forEach((t=>{const o=n.querySelector(`form-input[name="${t}"]`);o&&"object"==typeof e[t]?o.shadowRoot.updateInput(e[t]&&e[t].value?e[t].value:""):o&&o.shadowRoot.updateInput(e[t]?e[t]:"")})),r.appendChild(n)}removeRow(t){t.getAttribute("data-checked")?t.closest("details").remove():(t.setAttribute("data-checked","true"),t.setAttribute("data-text",t.textContent),t.textContent="Remove Confirm",t.addEventListener("mouseout",(()=>{this.resetButton(t)})))}resetButton(t){t.getAttribute("data-checked")&&(t.removeAttribute("data-checked"),t.textContent=t.getAttribute("data-text"))}saveData(t){const e=this.shadowRoot.querySelector("textarea#rows_data"),o=this.getAttribute("save-action"),r=[];let n=!1;e&&(n=!0,this.shadowRoot.querySelectorAll("#rows > .row").forEach((t=>{const e=getInputFields(t);r.push(e),n=!(!e.valid||!n)&&n})),console.log(r),n&&o&&"function"==typeof window[o]&&window[o].call(this,r,t))}loadData(){const t=this.getAttribute("load-data");if(t&&t.length>0){const e=JSON.parse(atob(t));Array.isArray(e)&&e.forEach((t=>{this.addRow(null,t,!1)}))}}}window.customElements.define("add-row",AddRows);
